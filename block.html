<!-- Layout for 4 chart -->
<div style='height:54px;'></div>
<div class="row">
  <div style='width:54px;'></div>
  <div class="card-deck">

    <!-- 1st floor -->
    <div class="card card-inverse text-white mb-3 text-center" style="background-color: #333333; border-color: #333333; width: 15rem;">
      <div class="card-header">
      	<h4>1st Floor</h4>
      </div>
      <div class="card-body" id="b1">
      	<div style='height:20px;'></div>
        <button type="button" class="btn btn-primary btn-lg">Front Clear</button>
        <div style='height:5px;'></div>
        <small class="text-muted" id="footer1">Retreiving data...</small>
        <div style='height:20px;'></div>
      </div>
      <div class="card-body" id="b2">
      	<div style='height:20px;'></div>
        <button type="button" class="btn btn-primary btn-lg">Back Clear</button>
        <div style='height:5px;'></div>
        <small class="text-muted" id="footer1">Retreiving data...</small>
        <div style='height:20px;'></div>
      </div>
    </div>

    <!-- 2nd floor -->
    <div class="card card-inverse text-white mb-3 text-center" style="background-color: #333333; border-color: #333333; width: 15rem;">
      <div class="card-header">
      	<h4>2nd Floor</h4>
      </div>
      <div class="card-body" id="b3">
      	<div style='height:20px;'></div>
        <button type="button" class="btn btn-primary btn-lg">Front Clear</button>
        <div style='height:5px;'></div>
        <small class="text-muted" id="footer1">Retreiving data...</small>
        <div style='height:20px;'></div>
      </div>

      <div class="card-body" id="b4">
      	<div style='height:20px;'></div>
        <button type="button" class="btn btn-primary btn-lg">Back Clear</button>
        <div style='height:5px;'></div>
        <small class="text-muted" id="footer1">Retreiving data...</small>
        <div style='height:20px;'></div>
      </div>
    </div>

    <!-- 3rd floor -->
    <div class="card card-inverse text-white mb-3 text-center" style="background-color: #333333; border-color: #333333; width: 15rem;">
      <div class="card-header">
      	<h4>3rd Floor</h4>
      </div>
      <div class="card-body" id="b5">
      	<div style='height:20px;'></div>
        <button type="button" class="btn btn-primary btn-lg">Front Clear</button>
        <div style='height:5px;'></div>
        <small class="text-muted" id="footer1">Retreiving data...</small>
        <div style='height:20px;'></div>
      </div>

      <div class="card-body" id="b6">
      	<div style='height:20px;'></div>
        <button type="button" class="btn btn-primary btn-lg">Back Clear</button>
        <div style='height:5px;'></div>
        <small class="text-muted" id="footer1">Retreiving data...</small>
        <div style='height:20px;'></div>
      </div>
    </div>
   
    <!-- 4th floor -->
    <div class="card card-inverse text-white mb-3 text-center" style="background-color: #333333; border-color: #333333; width: 15rem;">
      <div class="card-header">
      	<h4>4th Floor</h4>
      </div>
      <div class="card-body" id="b7">
      	<div style='height:20px;'></div>
        <button type="button" class="btn btn-primary btn-lg">Front Clear</button>
        <div style='height:5px;'></div>
        <small class="text-muted" id="footer1">Retreiving data...</small>
        <div style='height:20px;'></div>
      </div>

      <div class="card-body" id="b8">
      	<div style='height:20px;'></div>
        <button type="button" class="btn btn-primary btn-lg">Back Clear</button>
        <div style='height:5px;'></div>
        <small class="text-muted" id="footer1">Retreiving data...</small>
        <div style='height:20px;'></div>
      </div>
    </div>

  </div>
</div>

<script>
var maxToggle = 8;
var frontClear = `
		<div style='height:20px;'></div>
        <button type="button" class="btn btn-primary btn-lg">Front Clear</button>
        <div style='height:5px;'></div>
        <small class="text-muted" id="footer1">Retreiving data...</small>
        <div style='height:20px;'></div>
        `;

var backClear = `
		<div style='height:20px;'></div>
        <button type="button" class="btn btn-primary btn-lg">Back Clear</button>
        <div style='height:5px;'></div>
        <small class="text-muted" id="footer1">Retreiving data...</small>
        <div style='height:20px;'></div>
        `;

var frontBlock = `
		<div style='height:20px;'></div>
        <button type="button" class="btn btn-danger btn-lg">Front Block</button>
        <div style='height:5px;'></div>
        <small class="text-muted" id="footer1">Retreiving data...</small>
        <div style='height:20px;'></div>
        `;

var backBlock = `
		<div style='height:20px;'></div>
        <button type="button" class="btn btn-danger btn-lg">Back Block</button>
        <div style='height:5px;'></div>
        <small class="text-muted" id="footer1">Retreiving data...</small>
        <div style='height:20px;'></div>
        `;

for(var i=0 ; i<maxToggle ; i++)
{
	if(i%2 == 0)  $("#b"+ (index+1).toString()).html(frontClear);
	else 		  $("#b"+ (index+1).toString()).html(backClear);
}

function UpdateDisplay(index, mode, time)
{
	var html = "";
	if(mode == 0)
	{
		console.log("shit");
		if(index%2 == 0)	html = frontClear;
		else				html = backClear;
	}
	else
	{
		console.log("block");
		if(index%2 == 0)	html = frontBlock;
		else				html = backBlock;
	}
	$("#b"+ (index+1).toString()).html(html);

	var d = new Date(time);
	console.log(d.toLocaleString());
}




</script>

<script>
var urls = ["https://api.mediatek.com/mcs/v2/devices/D50Vc0GM/datachannels/display/datapoints",
			"https://api.mediatek.com/mcs/v2/devices/D50Vc0GM/datachannels/display/datapoints",
			"https://api.mediatek.com/mcs/v2/devices/D50Vc0GM/datachannels/display/datapoints",
			"https://api.mediatek.com/mcs/v2/devices/D50Vc0GM/datachannels/display/datapoints",
			"https://api.mediatek.com/mcs/v2/devices/D50Vc0GM/datachannels/display/datapoints",
            "https://api.mediatek.com/mcs/v2/devices/D50Vc0GM/datachannels/display/datapoints",
            "https://api.mediatek.com/mcs/v2/devices/D50Vc0GM/datachannels/display/datapoints",
           "https://api.mediatek.com/mcs/v2/devices/D50Vc0GM/datachannels/display/datapoints"];
var devKey = ["jur0mgrSH4gJ8KJr",
              "jur0mgrSH4gJ8KJr",
              "jur0mgrSH4gJ8KJr",
              "jur0mgrSH4gJ8KJr",
              "jur0mgrSH4gJ8KJr",
              "jur0mgrSH4gJ8KJr",
              "jur0mgrSH4gJ8KJr",
              "jur0mgrSH4gJ8KJr"];

/* AJAX set up */
var state = [0];
var xhrArr = [];
var CallBack = function(index){
  return function(){
    if(xhrArr[index].readyState == 4 && xhrArr[index].status == 200) 
      {
          /* Parse data once received */
          var data = JSON.parse(xhrArr[index].response).dataChannels[0].dataPoints[0];
          var dataPoint = data.values.value;
          var dataTime = data.recordedAt;
          console.log(dataTime);

          /* Update display */
          UpdateDisplay(index, Math.round(Math.random()), dataTime);
      }
  }
}

/* Request data for every minute, and record interval id for clearing in index.html*/
RequestMCSData();
intervalArr.push(setInterval(RequestMCSData, 10000));

function RequestMCSData()
{
    for(var i=0; i<maxToggle; i++) 
    {
      xhrArr[i]=new XMLHttpRequest();
      xhrArr[i].open("GET", urls[i], true);
      xhrArr[i].setRequestHeader("deviceKey", devKey[i]);
      xhrArr[i].setRequestHeader("Content-Type", "application/json");
      xhrArr[i].onreadystatechange=CallBack(i);
      xhrArr[i].send();
    }
} 

</script>



