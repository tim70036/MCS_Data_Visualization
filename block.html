<script type="text/javascript" src="https://code.jquery.com/ui/1.8.23/jquery-ui.min.js"></script>
<div style='height:54px;'></div>

<div class="row">
  <div style='width:54px;'></div>
  <div class="card card-inverse text-white mb-3 text-center color" style="width: 71.4rem;">
    <div style='height:40px;'></div>
    <h1>Block Status</h1>
    <div style='height:40px;'></div>
  </div>
</div>

<!-- Layout for 4 chart -->
<div class="row">
  <div style='width:54px;'></div>
  <div class="card-deck">

    <!-- 1st floor -->
    <div class="card card-inverse text-white mb-3 text-center color" style="width: 16.5rem;">
      <div class="card-header">
      	<div style='height:10px;'></div>
        <h4>1st Floor</h4>
      </div>
      <div class="card-body">
        <div style='height:40px;'></div>
        <button type="button"  id="b1" class="btn btn-primary btn-lg custom">Retreiving...</button>
        <div style='height:5px;'></div>
        <small class="text-white" id="f1">Retreiving data...</small>
        <div style='height:20px;'></div>
      </div>
      <div class="card-body" >
        <div style='height:20px;'></div>
        <button type="button" id="b2" class="btn btn-primary btn-lg custom">Retreiving...</button>
        <div style='height:5px;'></div>
        <small class="text-white" id="f2">Retreiving data...</small>
        <div style='height:20px;'></div>
      </div>
    </div>

    <!-- 2nd floor -->
    <div class="card card-inverse text-white mb-3 text-center color" style="width: 16.5rem;">
      <div class="card-header">
      	<div style='height:10px;'></div>
        <h4>2nd Floor</h4>
      </div>
      <div class="card-body" >
        <div style='height:40px;'></div>
        <button type="button" id="b3" class="btn btn-primary btn-lg custom">Retreiving...</button>
        <div style='height:5px;'></div>
        <small class="text-white" id="f3">Retreiving data...</small>
        <div style='height:20px;'></div>
      </div>

      <div class="card-body" >
        <div style='height:20px;'></div>
        <button type="button" id="b4" class="btn btn-primary btn-lg custom">Retreiving...</button>
        <div style='height:5px;'></div>
        <small class="text-white" id="f4">Retreiving data...</small>
        <div style='height:20px;'></div>
      </div>
    </div>

    <!-- 3rd floor -->
    <div class="card card-inverse text-white mb-3 text-center color" style="width: 16.5rem;">
      <div class="card-header">
      	<div style='height:10px;'></div>
        <h4>3rd Floor</h4>
      </div>
      <div class="card-body">
        <div style='height:40px;'></div>
        <button type="button"  id="b5" class="btn btn-primary btn-lg custom">Retreiving...</button>
        <div style='height:5px;'></div>
        <small class="text-white" id="f5">Retreiving data...</small>
        <div style='height:20px;'></div>
      </div>

      <div class="card-body">
        <div style='height:20px;'></div>
        <button type="button"  id="b6" class="btn btn-primary btn-lg custom">Retreiving...</button>
        <div style='height:5px;'></div>
        <small class="text-white" id="f6">Retreiving data...</small>
        <div style='height:20px;'></div>
      </div>
    </div>
   
    <!-- 4th floor -->
    <div class="card card-inverse text-white mb-3 text-center color" style="width: 16.5rem;">
      <div class="card-header">
      	<div style='height:10px;'></div>
        <h4>4th Floor</h4>
      </div>
      <div class="card-body" >
        <div style='height:40px;'></div>
        <button type="button" id="b7" class="btn btn-primary btn-lg custom">Retreiving...</button>
        <div style='height:5px;'></div>
        <small class="text-white" id="f7">Retreiving data...</small>
        <div style='height:20px;'></div>
      </div>

      <div class="card-body" >
        <div style='height:20px;'></div>
        <button type="button" id="b8" class="btn btn-primary btn-lg custom">Retreiving...</button>
        <div style='height:5px;'></div>
        <small class="text-white" id="f8">Retreiving data...</small>
        <div style='height:20px;'></div>
      </div>
    </div>

  </div>
</div>

<style>
	
	/* Button */
	.custom {
    width: 11.5rem !important;
	}

	/* bg */
	.color {
    background-color: #404040; 
    border-color: #404040; 
  	}
</style>

<script>

/* Var set up */
var maxToggle = 8;
var clearClass = "btn-success";
var blockClass = "btn-danger";
var delay = 200;

/* Update */
function UpdateDisplay(index, mode, time)
{
  var html="";
  if(index%2 == 0)  html = "Front";
  else        		html = "Back";


  /* Change class of button */
  if(mode == 0)
  {
    /* Change class of button */
    $("#b"+ (index+1).toString()).switchClass(blockClass, clearClass, delay);
    html += "    Clear";
  }
  else
  {
    
    $("#b"+ (index+1).toString()).switchClass(clearClass, blockClass, delay);
    html += " Blocked"
  }

  /* Change text of button */
  $("#b"+ (index+1).toString()).fadeOut(delay, function() 
  	{
    $(this).html(html).fadeIn(delay);
	});

  /* Change text of footer */
  var obj = new Date(time);
  var yr = new Date(time).toLocaleTimeString();
  var mn = new Date(time).toLocaleDateString();
  var d = obj.getFullYear() + "/" + (obj.getMonth()+1) + "/" + obj.getDate();
  var t = obj.getHours() + ":" + obj.getMinutes() + ":" + obj.getSeconds();
  $("#f"+ (index+1).toString()).fadeOut(delay, function() 
  	{
    $(this).html("since " + t + " " + d).fadeIn(delay);
	});
}




</script>

<script>
var urls = ["https://api.mediatek.com/mcs/v2/devices/D50Vc0GM/datachannels/display/datapoints",
      "https://api.mediatek.com/mcs/v2/devices/D50Vc0GM/datachannels/display/datapoints",
      "https://api.mediatek.com/mcs/v2/devices/D50Vc0GM/datachannels/display/datapoints",
      "https://api.mediatek.com/mcs/v2/devices/D50Vc0GM/datachannels/display/datapoints",
      "https://api.mediatek.com/mcs/v2/devices/D50Vc0GM/datachannels/display/datapoints",
            "https://api.mediatek.com/mcs/v2/devices/D50Vc0GM/datachannels/display/datapoints",
            "https://api.mediatek.com/mcs/v2/devices/D50Vc0GM/datachannels/display/datapoints",
           "https://api.mediatek.com/mcs/v2/devices/D50Vc0GM/datachannels/display/datapoints"];
var devKey = ["jur0mgrSH4gJ8KJr",
              "jur0mgrSH4gJ8KJr",
              "jur0mgrSH4gJ8KJr",
              "jur0mgrSH4gJ8KJr",
              "jur0mgrSH4gJ8KJr",
              "jur0mgrSH4gJ8KJr",
              "jur0mgrSH4gJ8KJr",
              "jur0mgrSH4gJ8KJr"];

/* AJAX set up */
var state = [0];
var xhrArr = [];
var CallBack = function(index){
  return function(){
    if(xhrArr[index].readyState == 4 && xhrArr[index].status == 200) 
      {
          /* Parse data once received */
          var data = JSON.parse(xhrArr[index].response).dataChannels[0].dataPoints[0];
          var dataPoint = data.values.value;
          var dataTime = data.recordedAt;
          console.log(dataPoint);
          /* Update display */
          UpdateDisplay(index, Math.round(Math.random()), dataTime);
      }
  }
}

/* Request data for every minute, and record interval id for clearing in index.html*/
RequestMCSData();
intervalArr.push(setInterval(RequestMCSData, 5000));

function RequestMCSData()
{
    for(var i=0; i<maxToggle; i++) 
    {
      xhrArr[i]=new XMLHttpRequest();
      xhrArr[i].open("GET", urls[i], true);
      xhrArr[i].setRequestHeader("deviceKey", devKey[i]);
      xhrArr[i].setRequestHeader("Content-Type", "application/json");
      xhrArr[i].onreadystatechange=CallBack(i);
      xhrArr[i].send();
    }
} 

</script>